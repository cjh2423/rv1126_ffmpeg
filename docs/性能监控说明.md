# ğŸ“Š æ€§èƒ½ç›‘æ§æ¨¡å—è¯´æ˜

æœ¬æ¨¡å—æä¾›ç³»ç»Ÿèµ„æºå’Œç¡¬ä»¶æ€§èƒ½çš„å®æ—¶ç›‘æ§åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…äº†è§£ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å¹¶è¿›è¡Œæ€§èƒ½è°ƒä¼˜ã€‚

---

## ğŸš€ æ¨¡å—ç®€ä»‹

- **æºæ–‡ä»¶**: `main/monitor/perf_monitor.c`, `main/monitor/perf_monitor.h`
- **åŠŸèƒ½å¼€å…³**: `config.h` ä¸­çš„ `APP_Test_PERF_MONITOR`
- **ç›‘æ§æŒ‡æ ‡**:
    - **CPU ä½¿ç”¨ç‡**: æ€»ä½“ CPU å ç”¨ç™¾åˆ†æ¯”åŠæ ¸å¿ƒæ•°
    - **å†…å­˜ä½¿ç”¨**: æ€»é‡ã€å·²ç”¨ã€å¯ç”¨åŠä½¿ç”¨ç‡
    - **èŠ¯ç‰‡æ¸©åº¦**: CPU/GPU æ¸©åº¦ (åŸºäº thermal_zone)
    - **è§†é¢‘æ€§èƒ½**: VI é‡‡é›†å¸§ç‡ã€VENC ç¼–ç å¸§ç‡ã€å®é™…ç ç‡
    - **ç³»ç»Ÿè¿è¡Œæ—¶é—´**: Uptime

---

## ğŸ› ï¸ ä½¿ç”¨æ–¹å¼

### 1. ç¼–è¯‘æ—¶å¼€å…³

åœ¨ `main/config/config.h` ä¸­ï¼š

```c
#define APP_Test_PERF_MONITOR   1   // 1=å¼€å¯, 0=å…³é—­
```

### 2. ä»£ç é›†æˆ

æ¨¡å—å·²åœ¨ `main.c` ä¸­è‡ªåŠ¨é›†æˆï¼Œç³»ç»Ÿå¯åŠ¨åä¼šè‡ªåŠ¨å¼€å§‹ç›‘æ§ï¼š

```c
#include "perf_monitor.h"

// åˆå§‹åŒ–å¹¶å¯åŠ¨ç›‘æ§ (æ¯ 10 ç§’æ‰“å°ä¸€æ¬¡æŠ¥å‘Š)
perf_monitor_init();
perf_monitor_start(10);

// ç¨‹åºé€€å‡ºå‰
perf_monitor_deinit();
```

### 3. æ‰‹åŠ¨æŸ¥è¯¢

ä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­æ‰‹åŠ¨è·å–æ€§èƒ½æ•°æ®ï¼š

```c
CpuStats cpu;
MemStats mem;
TempStats temp;
PerfReport report;

// åˆ†åˆ«è·å–
perf_get_cpu_stats(&cpu);
perf_get_mem_stats(&mem);
perf_get_temp_stats(&temp);

// æˆ–ä¸€æ¬¡æ€§è·å–å®Œæ•´æŠ¥å‘Š
perf_get_report(&report);

// æ‰‹åŠ¨æ‰“å°æŠ¥å‘Šåˆ°æ—¥å¿—
perf_print_report();
```

### 4. è§†é¢‘æ€§èƒ½æ›´æ–°

è§†é¢‘æ¨¡å—å¯ä»¥è°ƒç”¨ä»¥ä¸‹å‡½æ•°æ›´æ–°è§†é¢‘æ€§èƒ½ç»Ÿè®¡ï¼š

```c
// åœ¨ç¼–ç çº¿ç¨‹ä¸­å®šæœŸè°ƒç”¨
perf_update_video_stats(vi_fps, venc_fps, bitrate_kbps);
```

---

## ğŸ“‹ è¾“å‡ºç¤ºä¾‹

è¿è¡Œæ—¶æ—¥å¿—è¾“å‡ºç¤ºä¾‹ï¼š

```
[perf_monitor][perf_print_report]:==== Performance Report ====
[perf_monitor][perf_print_report]:CPU: 25.3% (4 cores)
[perf_monitor][perf_print_report]:MEM: 45.2% (230/512 MB used)
[perf_monitor][perf_print_report]:TEMP: CPU=52.0Â°C, GPU=48.5Â°C
[perf_monitor][perf_print_report]:VIDEO: VI=30.0fps, VENC=29.8fps, Bitrate=4012Kbps
[perf_monitor][perf_print_report]:UPTIME: 2h 15m 32s
[perf_monitor][perf_print_report]:============================
```

---

## ğŸ“‚ API å‚è€ƒ

| å‡½æ•° | è¯´æ˜ |
|------|------|
| `perf_monitor_init()` | åˆå§‹åŒ–æ¨¡å— |
| `perf_monitor_deinit()` | ååˆå§‹åŒ–æ¨¡å— |
| `perf_monitor_start(interval)` | å¯åŠ¨åå°ç›‘æ§çº¿ç¨‹ï¼Œæ¯ interval ç§’æ‰“å°æŠ¥å‘Š |
| `perf_monitor_stop()` | åœæ­¢åå°ç›‘æ§çº¿ç¨‹ |
| `perf_get_cpu_stats(CpuStats*)` | è·å– CPU ç»Ÿè®¡ |
| `perf_get_mem_stats(MemStats*)` | è·å–å†…å­˜ç»Ÿè®¡ |
| `perf_get_temp_stats(TempStats*)` | è·å–æ¸©åº¦ç»Ÿè®¡ |
| `perf_get_report(PerfReport*)` | è·å–ç»¼åˆæ€§èƒ½æŠ¥å‘Š |
| `perf_print_report()` | æ‰“å°æ€§èƒ½æŠ¥å‘Šåˆ°æ—¥å¿— |
| `perf_update_video_stats(...)` | æ›´æ–°è§†é¢‘æ€§èƒ½ç»Ÿè®¡ (ç”± video æ¨¡å—è°ƒç”¨) |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¸©åº¦è¯»å–**: ä¾èµ– `/sys/class/thermal/thermal_zone*` èŠ‚ç‚¹ï¼Œå¦‚æœè®¾å¤‡ä¸æ”¯æŒå¯èƒ½è¿”å› -1ã€‚
2. **CPU ä½¿ç”¨ç‡**: åŸºäºä¸¤æ¬¡é‡‡æ ·é—´éš”è®¡ç®—å·®å€¼ï¼Œé¦–æ¬¡è°ƒç”¨å¯èƒ½ä¸å‡†ç¡®ã€‚
3. **è§†é¢‘ç»Ÿè®¡**: éœ€è¦ video æ¨¡å—ä¸»åŠ¨è°ƒç”¨ `perf_update_video_stats()` æ›´æ–°æ•°æ®ã€‚
4. **çº¿ç¨‹å®‰å…¨**: å†…éƒ¨ä½¿ç”¨äº’æ–¥é”ä¿æŠ¤è§†é¢‘ç»Ÿè®¡æ•°æ®ï¼Œå¯å®‰å…¨è·¨çº¿ç¨‹è°ƒç”¨ã€‚
