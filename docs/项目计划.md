# RV1126 视频监控推流系统项目规划

## 1. 项目概述
本项目基于 Rockchip RV1126 平台，构建一套集视频采集、处理、编码与推流于一体的系统。

**主要技术栈**：
- **采集**: V4L2 / Rockchip VI (ISP)
- **处理**: Rockchip RGA / ISP
- **编码**: Rockchip MPP (硬件加速)
- **推流**: FFmpeg / RTMP

## 2. 工程目录结构 (最新)

```text
rv_demo/
├── 3rdparty/               # 第三方 SDK 与依赖 (FFmpeg, Media SDK)
├── build.sh                # 自动化编译脚本
├── CMakeLists.txt          # 工程构建配置
├── include/                # 应用头文件
│   ├── capture/            # 采集模块接口
│   ├── encoder/            # 编码模块接口
│   ├── streamer/           # 推流模块接口
│   ├── common/             # [官方] ISP, Param, Sysutil 头文件
│   └── config.h            # 静态全局配置
├── src/                    # 源码
│   ├── main.c              # 业务入口
│   ├── config.c            # 配置实现与链接桩
│   ├── capture/            # 摄像头采集逻辑
│   ├── common/             # [官方] Rockchip SDK 公共组件 (保持原始)
│   │   ├── isp/            # 图像信号处理控制
│   │   ├── param/          # 参数管理与 INI 读写
│   │   └── sysutil/        # 系统底层工具
│   ├── encoder/            # MPP 编码逻辑 (预留)
│   └── streamer/           # 推流逻辑实现
└── docs/                   # 说明文档
```

## 3. 开发实施路线

### 阶段一：基础架构与 ISP 集成 (完成)
- [x] 搭建项目骨架，实现 C 语言 Hello World。
- [x] 集成 FFmpeg 测试。
- [x] **ISP 集成**: 引入官方 `isp`, `param`, `sysutil` 模块，解决 MIPI 图像曝光过暗问题。
- [x] **目录解耦**: 实现应用逻辑与官方 SDK 代码的分离。

### 阶段二：稳定采集与处理 (进行中)
- [ ] 完善 `video_capture` 模块，支持更稳定的缓冲区管理。
- [ ] 接入 `librga` 进行图像格式转换与缩放测试。

### 阶段三：硬件编码 (Encoder)
- [ ] 接入 Rockchip MPP 库。
- [ ] 实现 H.264 / H.265 硬件编码。

### 阶段四：网络推流 (Streamer)
- [ ] 完善 FFmpeg RTMP 推流。
- [ ] 实现断线重连与音视频同步。

## 4. 开发准则
1. **官方优先**: `src/common` 下的代码尽量保持与 SDK 一致，避免私自修改逻辑，以便于后续合并 SDK 更新。
2. **应用解耦**: 所有的应用配置和特定的 Mock 逻辑应放在 `src/config.c` 或主逻辑中。
3. **参数化**: 尽量通过 `rk_param` (INI) 或 `config.h` 管理参数，避免硬编码。
