# ğŸ“ Video æ¨¡å—æ ¸å¿ƒè§£è¯»

æœ¬ç›®å½•åŒ…å« `main/video/` çš„æ ¸å¿ƒå®ç°ï¼Œè´Ÿè´£ä»å›¾åƒé‡‡é›† (VI) åˆ°ç¡¬ä»¶ç¼–ç  (VENC) å†åˆ°ç½‘ç»œæ¨æµ (RTSP) çš„å®Œæ•´ä¸šåŠ¡é—­ç¯ã€‚

---

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

- **åŒè·¯å¹¶è¡Œç¼–ç **: åŒæ—¶ç»´æŠ¤ä¸¤è·¯ VENC é€šé“ï¼Œæ”¯æŒä¸»/å­ç æµç‹¬ç«‹é…ç½®ã€‚
- **RTSP è‡ªåŠ¨åŒ–åˆ†å‘**: ç¼–ç åçš„æ¯ä¸€å¸§éƒ½ä¼šæ ¹æ®é…ç½®è‡ªåŠ¨æ¨é€åˆ°å¯¹åº”çš„ RTSP æœåŠ¡å¥æŸ„ã€‚
- **çº¿ç¨‹åŒ–ç®¡ç†**: é‡‡ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼ŒVI æ•°æ®é€šè¿‡ MPI è‡ªåŠ¨æ¨é€è‡³ VENCï¼ŒVENC ç»“æœåœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­å¼‚æ­¥å¤„ç†ã€‚
- **çµæ´»çš„è¾“å‡ºç­–ç•¥**: å¯ä»¥åœ¨ `config.h` ä¸­å¼€å…³æœ¬åœ°æ–‡ä»¶ä¿å­˜ä¸ç½‘ç»œæ¨æµåŠŸèƒ½ã€‚

---

## ğŸ› ï¸ ä»£ç ç»“æ„æ‹†è§£

### 1. èµ„æºç”Ÿå‘½å‘¨æœŸ (`video.c`)
- **`rk_video_init`**:
  - æ‰§è¡Œ `VI` è®¾å¤‡ä¸ç®¡é“åˆå§‹åŒ–ã€‚
  - åˆ›å»ºå¹¶é…ç½® `VENC` é€šé“ï¼ˆæ”¯æŒ H.264/H.265ï¼‰ã€‚
  - **å…³é”®ç‚¹**: æ‰§è¡Œ `RK_MPI_SYS_Bind` å»ºç«‹ç¡¬ä»¶å±‚é¢çš„ VI -> VENC è¿æ¥ã€‚
  - å¯åŠ¨ `venc_get_stream_thread` è½®è¯¢çº¿ç¨‹ã€‚
- **`rk_video_deinit`**: åœæ­¢å¤„ç†çº¿ç¨‹ï¼Œè§£ç»‘é“¾è·¯ï¼Œé‡Šæ”¾ç¡¬ä»¶èµ„æºã€‚

### 2. æµå¤„ç†é€»è¾‘
- **`venc_get_stream_thread`**:
  - è°ƒç”¨ `RK_MPI_VENC_GetStream` è·å–å‹ç¼©å¸§ã€‚
  - å¯¹å¸§æ•°æ®è¿›è¡Œ PTS æ—¶é—´æˆ³å¯¹é½ã€‚
  - è°ƒç”¨ `rkipc_rtsp_write_video_frame` æ¨æµã€‚

---

## âš™ï¸ INI é…ç½®ç»‘å®š

æœ¬æ¨¡å—å·²æ¥å…¥ `common/param` ç³»ç»Ÿï¼Œä»¥ä¸‹å‚æ•°å¯é€šè¿‡ `rkipc.ini` åŠ¨æ€ä¿®æ”¹ï¼š

- `[video.0]` & `[video.1]`:
  - `width` / `height` / `fps`
  - `bitrate` / `gop`
  - `output_data_type` (H.264/H.265)

---

## ğŸ“ å¼€å‘å¤‡æ³¨
- **å†…å­˜å®‰å…¨**: ç æµè·å–ä½¿ç”¨çš„æ˜¯ SDK çš„ DMABUF æ¨¡å¼ï¼Œå¤„ç†å®ŒååŠ¡å¿…è°ƒç”¨ `RK_MPI_VENC_ReleaseStream`ã€‚
- **å¤šæµé™åˆ¶**: è™½ç„¶ RV1126 æ”¯æŒå¤šè·¯ç¼–ç ï¼Œä½†æ€»å¸¦å®½å— ISP ååé‡é™åˆ¶ï¼Œå»ºè®®åŒè·¯ 1080P@30fps ä½œä¸ºæ€§èƒ½ä¸Šé™ã€‚
